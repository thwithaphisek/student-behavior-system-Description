<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
    <style>
        /* ==================================
           ==  CSS STYLE  ==
           ================================== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 15px; padding: 20px; margin-bottom: 30px; box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37); border: 1px solid rgba(255, 255, 255, 0.18); }
        .header h1 { text-align: center; color: #2c3e50; margin-bottom: 20px; font-size: 2.5rem; background: linear-gradient(45deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .nav { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
        .nav-btn { background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; padding: 12px 20px; border-radius: 25px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); position: relative; overflow: hidden; }
        .nav-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6); }
        .nav-btn.active { background: linear-gradient(45deg, #764ba2, #667eea); transform: translateY(-2px); }
        .page { display: none; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 15px; padding: 30px; box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37); border: 1px solid rgba(255, 255, 255, 0.18); animation: fadeIn 0.5s ease-in; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .page h2 { margin-bottom: 25px; color: #2c3e50; font-size: 1.8rem; border-bottom: 3px solid #667eea; padding-bottom: 10px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 16px; transition: all 0.3s ease; background-color: #fff; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); transform: translateY(-1px); }
        .signature-canvas { border: 2px dashed #ccc; border-radius: 8px; width: 100%; height: 150px; cursor: crosshair; touch-action: none; }
        .btn { background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; padding: 12px 30px; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); }
        .btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-success { background: linear-gradient(45deg, #28a745, #20c997); }
        .btn-danger { background: linear-gradient(45deg, #dc3545, #fd7e14); }
        .btn-warning { background: linear-gradient(45deg, #ffc107, #fd7e14); }
        .btn-info { background: linear-gradient(45deg, #17a2b8, #6f42c1); }
        .alert { padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: 500; animation: slideIn 0.3s ease-out; }
        .alert-success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .alert-danger { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .alert-info { background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .alert-warning { background-color: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        .table th, .table td { padding: 12px; text-align: left; border-bottom: 1px solid #e9ecef; }
        .table th { background: linear-gradient(45deg, #667eea, #764ba2); color: white; font-weight: 600; position: sticky; top: 0; z-index: 10; }
        .table tr:nth-child(even) { background-color: #f8f9fa; }
        .status-badge { padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; text-align: center; display: inline-block; color: white; }
        .status-‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏¢ { background-color: #dc3545; }
        .status-‡∏à‡∏¥‡∏ï‡∏≠‡∏≤‡∏™‡∏≤ { background-color: #28a745; }
        .status-‡∏≠‡∏∑‡πà‡∏ô‡πÜ { background-color: #6c757d; }
        .follow-‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß { background-color: #28a745; }
        .follow-‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ { background-color: #ffc107; color: #212529; }
        .follow-‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•, .follow-‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß { background-color: #17a2b8; }
        .follow-‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ { background-color: #6c757d; }
        .status-scan-‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ { background-color: #ffc107; color: #212529; }
        .status-scan-‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ { background-color: #28a745; }
        .status-scan-‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ { background-color: #dc3545; }
        .grade-filter-container { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
        .grade-filter-btn { padding: 8px 16px; border-radius: 20px; border: 2px solid #667eea; background-color: white; color: #667eea; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        .grade-filter-btn:hover, .grade-filter-btn.active { background-color: #667eea; color: white; }
        .home-menu { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 25px; text-align: center; }
        .home-card { background: white; border-radius: 15px; padding: 30px 20px; box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2); transition: all 0.3s ease; cursor: pointer; }
        .home-card:hover { transform: translateY(-10px); }
        .home-card-icon { font-size: 4rem; margin-bottom: 15px; }
        .admin-page { display: none; animation: fadeIn 0.3s ease-in; }
        .admin-page.active { display: block; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 10000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .offense-group { border: 1px solid #e0e0e0; background: #fdfdfd; padding: 15px; border-radius: 8px; margin-top: 15px; }
        .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .doc-status-badge { padding: 5px 12px; border-radius: 20px; font-size: 13px; font-weight: 600; color: white; }
        .doc-status-‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ { background-color: #ffc107; color: #212529; }
        .doc-status-‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß { background-color: #17a2b8; }
        .doc-status-‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß { background-color: #28a745; }
        .sig-status { display: inline-block; padding: 4px 10px; border-radius: 15px; font-size: 12px; font-weight: 600; margin: 2px; border: 1px solid transparent; }
        .sig-status-pending { background-color: #fff3cd; color: #856404; border-color: #ffeeba; }
        .sig-status-signed { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
        .profile-card { background: white; border-radius: 10px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .profile-card h3 { font-size: 1.5rem; color: #667eea; margin-bottom: 15px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; }
        .stats-card { background: white; border-radius: 15px; padding: 20px; margin: 10px 0; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); text-align: center; position: relative; overflow: hidden; }
        .stats-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(45deg, #667eea, #764ba2); }
        .stats-number { font-size: 2.5rem; font-weight: bold; color: #667eea; margin: 10px 0; }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .header h1 { font-size: 2rem; }
            .nav { gap: 5px; }
            .nav-btn { font-size: 12px; padding: 10px 12px; }
            .table { font-size: 14px; }
            .home-menu { grid-template-columns: 1fr 1fr; gap: 15px; }
            .dashboard-details-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
            <div class="nav">
                <button class="nav-btn active" onclick="showPage('home')">üè† ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
                <button class="nav-btn" onclick="showPage('late')">üèÉ ‡∏°‡∏≤‡∏™‡∏≤‡∏¢</button>
                <button class="nav-btn" onclick="showPage('forgot_scan')">üôã ‡∏•‡∏∑‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
                <button class="nav-btn" onclick="showPage('lending')">üì¶ ‡∏¢‡∏∑‡∏°‡∏Ç‡∏≠‡∏á</button>
                <button class="nav-btn" onclick="showPage('documents')">üìë ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</button>
                <button class="nav-btn" onclick="showPage('camp')">üèïÔ∏è ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏¢</button>
                <button class="nav-btn" onclick="showPage('specific_data')">üö´ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞</button>
                <button class="nav-btn" onclick="showPage('profile')">üë§ ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                <button class="nav-btn" onclick="showPage('admin')">‚öôÔ∏è ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </div>

        <div id="home" class="page active">
            <h2>üè† ‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</h2>
            <p style="text-align: center; margin-bottom: 30px; font-size: 1.1rem; color: #495057;">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
            <div class="home-menu">
                <div class="home-card" onclick="showPage('late', true)"><div class="home-card-icon">üèÉ</div><h3>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏°‡∏≤‡∏™‡∏≤‡∏¢</h3></div>
                <div class="home-card" onclick="showPage('forgot_scan', true)"><div class="home-card-icon">üôã</div><h3>‡πÅ‡∏à‡πâ‡∏á‡∏•‡∏∑‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏ô‡πâ‡∏≤</h3></div>
                <div class="home-card" onclick="showPage('lending', true)"><div class="home-card-icon">üì¶</div><h3>‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏Ç‡∏≠‡∏á</h3></div>
                <div class="home-card" onclick="showPage('documents', true)"><div class="home-card-icon">üìë</div><h3>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h3></div>
                <div class="home-card" onclick="showPage('camp', true)"><div class="home-card-icon">üèïÔ∏è</div><h3>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏¢</h3></div>
                <div class="home-card" onclick="showPage('specific_data', true)"><div class="home-card-icon">üö´</div><h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞</h3></div>
                <div class="home-card" onclick="showPage('profile', true)"><div class="home-card-icon">üë§</div><h3>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3></div>
                <div class="home-card" onclick="showPage('admin', true)"><div class="home-card-icon">‚öôÔ∏è</div><h3>‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h3></div>
            </div>
        </div>

        <div id="late" class="page">
            <h2>üèÉ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏°‡∏≤‡∏™‡∏≤‡∏¢</h2>
            <form id="lateForm">
                <div class="form-row">
                    <div class="form-group"><label>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô *</label><input type="text" id="lateStudentId" required placeholder="S001234"></div>
                    <div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label><input type="text" id="lateFullName" required placeholder="‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ"></div>
                </div>
                <div class="form-row"><div class="form-group"><label>‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô *</label><input type="text" id="lateClassroom" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 6/1"></div></div>
                <div class="form-group">
                    <label>‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô (‡∏ß‡∏≤‡∏î‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠) *</label>
                    <canvas id="lateSignatureCanvas" class="signature-canvas"></canvas>
                    <button type="button" onclick="clearSignature()" class="btn btn-warning" style="margin-top: 10px;">‚úèÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
                </div>
                <button type="submit" class="btn"><span id="lateSubmitLoading" style="display: none;" class="loading"></span><span id="lateSubmitText">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span></button>
            </form>
            <hr style="margin: 30px 0; border: 1px solid #e9ecef;">
            <h3>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏°‡∏≤‡∏™‡∏≤‡∏¢ (‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)</h3>
            <div id="lateData"><div class="alert alert-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div></div>
        </div>

        <div id="forgot_scan" class="page">
            <h2>üôã ‡πÅ‡∏à‡πâ‡∏á‡∏•‡∏∑‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏ô‡πâ‡∏≤</h2>
            <form id="forgotScanForm">
                <div class="form-row">
                    <div class="form-group"><label>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô *</label><input type="text" id="forgotStudentId" required placeholder="S001234"></div>
                    <div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label><input type="text" id="forgotFullName" required></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô *</label><input type="text" id="forgotClassroom" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 6/1"></div>
                    <div class="form-group"><label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏∑‡∏°‡∏™‡πÅ‡∏Å‡∏ô *</label><input type="date" id="forgotDate" required></div>
                </div>
                <button type="submit" class="btn"><span id="forgotScanSubmitLoading" style="display: none;" class="loading"></span><span id="forgotScanSubmitText">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span></button>
            </form>
            <hr style="margin: 30px 0; border: 1px solid #e9ecef;">
            <h3>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏•‡∏∑‡∏°‡∏™‡πÅ‡∏Å‡∏ô (‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)</h3>
            <div id="forgotScanData"><div class="alert alert-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div></div>
        </div>

        <div id="lending" class="page">
            <h2>üì¶ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏Ç‡∏≠‡∏á</h2>
            <form id="lendingForm">
                <div class="form-row">
                    <div class="form-group"><label>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô *</label><input type="text" id="lendingStudentId" required></div>
                    <div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label><input type="text" id="lendingFullName" required></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô *</label><input type="text" id="lendingClassroom" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 6/1"></div>
                    <div class="form-group"><label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠</label><input type="tel" id="lendingPhone"></div>
                </div>
                <div class="form-group"><label>‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏° *</label><input type="text" id="lendingItem" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡∏π‡∏Å‡∏ö‡∏≤‡∏™‡πÄ‡∏Å‡∏ï‡∏ö‡∏≠‡∏•"></div>
                <button type="submit" class="btn"><span id="lendingSubmitLoading" style="display: none;" class="loading"></span><span id="lendingSubmitText">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</span></button>
            </form>
            <hr style="margin: 30px 0; border: 1px solid #e9ecef;">
            <h3>üì¶ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏∑‡∏ô</h3>
            <div id="lendingData"><div class="alert alert-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div></div>
        </div>

        <div id="documents" class="page">
            <h2>üìë ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
            <div class="search-container">
                <input type="text" id="docSearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." onkeyup="filterDocumentData()">
                <select id="docStatusFilter" onchange="filterDocumentData()" style="flex: 0.5;"><option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option><option value="‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option><option value="‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß">‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß</option><option value="‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option></select>
            </div>
            <div id="documentData" style="overflow-x: auto;"><div class="alert alert-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div></div>
        </div>

        <div id="camp" class="page">
            <h2>üèïÔ∏è ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏¢</h2>
            <div style="display: flex; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                <button onclick="exportCampData()" class="btn btn-info">üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                <div>
                    <select id="campStatusFilter" onchange="filterCampData()" class="camp-status-select"><option value="">üèïÔ∏è ‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option><option value="‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏¢">‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏¢</option><option value="‡∏à‡∏¥‡∏ï‡∏≠‡∏≤‡∏™‡∏≤">‡∏à‡∏¥‡∏ï‡∏≠‡∏≤‡∏™‡∏≤</option><option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option></select>
                    <select id="campFollowFilter" onchange="filterCampData()" class="camp-status-select"><option value="">üìã ‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</option><option value="‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß</option><option value="‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option></select>
                </div>
            </div>
            <div class="grade-filter-container">
                <button class="grade-filter-btn active" onclick="filterByGrade('all', event)">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                <button class="grade-filter-btn" onclick="filterByGrade('1', event)">‡∏°.1</button>
                <button class="grade-filter-btn" onclick="filterByGrade('2', event)">‡∏°.2</button>
                <button class="grade-filter-btn" onclick="filterByGrade('3', event)">‡∏°.3</button>
                <button class="grade-filter-btn" onclick="filterByGrade('4', event)">‡∏°.4</button>
                <button class="grade-filter-btn" onclick="filterByGrade('5', event)">‡∏°.5</button>
                <button class="grade-filter-btn" onclick="filterByGrade('6', event)">‡∏°.6</button>
            </div>
            <div id="campStats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;"></div>
            <div id="campData"><div class="alert alert-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div></div>
        </div>

        <div id="specific_data" class="page">
            <div id="specificDataLogin">
                <h2>üö´ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞</h2>
                <div class="login-form">
                    <div class="form-group"><label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label><input type="password" id="specificDataPassword"></div>
                    <button onclick="specificDataLogin()" class="btn btn-danger" style="width: 100%;"><span id="specificDataLoginLoading" style="display:none;" class="loading"></span><span id="specificDataLoginText">üîì ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ</span></button>
                </div>
                <div id="specificDataLoginMessage"></div>
            </div>
            <div id="specificDataView" style="display: none;">
                <h2>üö´ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞</h2>
                <div class="search-container"><input type="text" id="specificDataSearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." onkeyup="filterSpecificData()"></div>
                <div id="specificDataTableContainer" style="overflow-x: auto;"><div class="alert alert-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div></div>
            </div>
        </div>

        <div id="profile" class="page">
            <h2>üë§ ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
            <div class="search-container">
                <input type="text" id="profileSearchId" placeholder="‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô..." onkeyup="if(event.key==='Enter') searchStudentProfile()">
                <button onclick="searchStudentProfile()" class="btn"><span id="profileSearchLoading" style="display:none;" class="loading"></span><span id="profileSearchText">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</span></button>
            </div>
            <div id="profileResultContainer"><div class="alert alert-info">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div></div>
        </div>

        <div id="admin" class="page">
            <div id="loginSection">
                <h2>üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h2>
                <div class="login-form">
                    <div class="form-group"><label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label><input type="password" id="adminPassword"></div>
                    <button onclick="adminLogin()" class="btn" style="width: 100%;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                </div>
                <div id="loginMessage"></div>
            </div>
            <div id="adminPanel" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>‚öôÔ∏è ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h2>
                    <button onclick="adminLogout()" class="btn btn-danger">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
                </div>
                <div class="admin-nav">
                    <button id="nav-dashboard" class="admin-nav-btn active" onclick="showAdminPage('dashboard')">üìà Dashboard</button>
                    <button id="nav-camp" class="admin-nav-btn" onclick="showAdminPage('camp')">üèïÔ∏è ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏¢</button>
                    <button id="nav-specific_data" class="admin-nav-btn" onclick="showAdminPage('specific_data')">üö´ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞</button>
                    <button id="nav-late" class="admin-nav-btn" onclick="showAdminPage('late')">üèÉ ‡∏°‡∏≤‡∏™‡∏≤‡∏¢</button>
                    <button class="nav-btn" onclick="showPage('forgot_scan')">üôã ‡∏•‡∏∑‡∏°‡∏™‡πÅ‡∏Å‡∏ô</button>
                    <button id="nav-lending" class="admin-nav-btn" onclick="showAdminPage('lending')">üì¶ ‡∏¢‡∏∑‡∏°‡∏Ç‡∏≠‡∏á</button>
                    <button id="nav-documents" class="admin-nav-btn" onclick="showAdminPage('documents')">üìë ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</button>
                </div>
                
                <div id="admin-page-dashboard" class="admin-page active">
                    <h3>üìà Dashboard</h3>
                    <div class="form-row" style="align-items: flex-end; margin-bottom: 20px;">
                        <div class="form-group"><label>‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà</label><input type="date" id="dashStartDate"></div>
                        <div class="form-group"><label>‡∏ñ‡∏∂‡∏á</label><input type="date" id="dashEndDate"></div>
                        <div class="form-group"><button onclick="loadDashboardData(true)" class="btn" style="width:100%;">üîç ‡∏Å‡∏£‡∏≠‡∏á</button></div>
                    </div>
                    <div id="dashboardStats" class="dashboard-grid"></div>
                    <div id="dashboardDetails" class="dashboard-details-grid">
                         <div id="dashboardLateDetail"></div><div id="dashboardLendingDetail"></div>
                    </div>
                </div>

                <div id="admin-page-camp" class="admin-page">
                    <div class="admin-section-header"><h3>üèïÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏¢</h3><div class="action-buttons"><button onclick="openCampModal()" class="btn btn-success">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°</button><button onclick="testData('camp')" class="btn btn-warning">üß™ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button></div></div>
                    <div id="adminCampData"><div class="alert alert-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div></div>
                </div>
                <div id="admin-page-specific_data" class="admin-page">
                    <div class="admin-section-header"><h3>üö´ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞</h3><div class="action-buttons"><button onclick="openSpecificDataModal()" class="btn btn-success">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°</button><button onclick="testData('specific_data')" class="btn btn-warning">üß™ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button></div></div>
                    <div id="adminSpecificData"><div class="alert alert-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div></div>
                </div>
                <div id="admin-page-late" class="admin-page">
                    <div class="admin-section-header"><h3>üèÉ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡∏™‡∏≤‡∏¢</h3><div class="action-buttons"><button onclick="testData('late')" class="btn btn-warning">üß™ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button></div></div>
                    <div id="adminLateData"><div class="alert alert-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div></div>
                </div>
                <div id="admin-page-forgot_scan" class="admin-page">
                    <div class="admin-section-header"><h3>üôã ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏∑‡∏°‡∏™‡πÅ‡∏Å‡∏ô</h3><div class="action-buttons"><button onclick="testData('forgot_scan')" class="btn btn-warning">üß™ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button></div></div>
                    <div id="adminForgotScanData"><div class="alert alert-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div></div>
                </div>
                <div id="admin-page-lending" class="admin-page">
                    <div class="admin-section-header"><h3>üì¶ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏Ç‡∏≠‡∏á</h3><div class="action-buttons"><button onclick="testData('lending')" class="btn btn-warning">üß™ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button></div></div>
                    <div id="adminLendingData"><div class="alert alert-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div></div>
                </div>
                <div id="admin-page-documents" class="admin-page">
                    <div class="admin-section-header"><h3>üìë ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h3><div class="action-buttons"><button onclick="openDocumentModal()" class="btn btn-success">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°</button><button onclick="testData('documents')" class="btn btn-warning">üß™ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button></div></div>
                    <div id="adminDocumentData"><div class="alert alert-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div></div>
                </div>
            </div>
        </div>
    </div>

    <div id="campModal" class="modal">
        <div class="modal-content">
            <h3 id="campModalTitle">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏¢</h3>
            <form id="campForm">
                <input type="hidden" id="campRowIndex">
                <div class="form-row">
                    <div class="form-group"><label>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label><input type="text" id="campStudentId" required></div>
                    <div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input type="text" id="campFullName" required></div>
                </div>
                <div class="form-group"><label>‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label><select id="campClassroom" required><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option><option value="‡∏°.1/1">‡∏°.1/1</option><option value="‡∏°.2/1">‡∏°.2/1</option><option value="‡∏°.3/1">‡∏°.3/1</option><option value="‡∏°.4/1">‡∏°.4/1</option><option value="‡∏°.5/1">‡∏°.5/1</option><option value="‡∏°.6/1">‡∏°.6/1</option></select></div>
                <div class="form-row">
                    <div class="form-group"><label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label><select id="campStatus"><option value="‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏¢">‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏¢</option><option value="‡∏à‡∏¥‡∏ï‡∏≠‡∏≤‡∏™‡∏≤">‡∏à‡∏¥‡∏ï‡∏≠‡∏≤‡∏™‡∏≤</option><option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option></select></div>
                    <div class="form-group"><label>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</label><select id="campFollow"><option value="‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option><option value="‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option><option value="‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß</option></select></div>
                </div>
                <div class="form-group">
                    <label for="campNote">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                    <textarea id="campNote" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)" maxlength="300"></textarea>
                </div>
                <div class="modal-footer"><button type="button" onclick="closeModal('campModal')" class="btn" style="background:#6c757d;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button type="submit" class="btn btn-success">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div>
            </form>
        </div>
    </div>

    <div id="specificDataModal" class="modal"><div class="modal-content"><h3 id="specificDataModalTitle">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3><form id="specificDataForm"><input type="hidden" id="specificDataRowIndex"><div class="form-row"><div class="form-group"><label>‡∏£‡∏´‡∏±‡∏™</label><input type="text" id="specificDataStudentId" required></div><div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠</label><input type="text" id="specificDataFullName" required></div></div><div class="form-group"><label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label><textarea id="specificDataAddress"></textarea></div><div class="form-row"><div class="form-group"><label>‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</label><input type="text" id="specificDataParentName"></div><div class="form-group"><label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label><input type="text" id="specificDataParentPhone"></div></div><div id="specificOffensesContainer"></div><button type="button" onclick="addSpecificOffenseField()" class="btn btn-info">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î</button><div class="modal-footer"><button type="button" onclick="closeModal('specificDataModal')" class="btn" style="background:#6c757d;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button type="submit" class="btn btn-success">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div></form></div></div>

    <div id="documentModal" class="modal"><div class="modal-content"><h3 id="documentModalTitle">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h3><form id="documentForm"><input type="hidden" id="docRowIndex"><div class="form-row"><div class="form-group"><label>‡∏£‡∏´‡∏±‡∏™</label><input type="text" id="docStudentId" required></div><div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠</label><input type="text" id="docFullName" required></div></div><div class="form-row"><div class="form-group"><label>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</label><select id="docType"><option value="‡πÉ‡∏ö‡∏•‡∏≤‡∏≠‡∏≠‡∏Å">‡πÉ‡∏ö‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</option><option value="‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á">‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á</option></select></div><div class="form-group"><label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label><select id="docStatus"><option value="‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option><option value="‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option></select></div></div><div class="modal-footer"><button type="button" onclick="closeModal('documentModal')" class="btn" style="background:#6c757d;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button type="submit" class="btn btn-success">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div></form></div></div>

    <script>
        // ‚ö†Ô∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç URL ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á Web App ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzusGiKKkr5kLSS5-bD8MES-Sr_xnw6YK8Nxxj5bEUalttIrEL3j_xM-yuUZCAaUm6dFQ/exec';

        // --- Variables ---
        let currentPage = 'home';
        let isAdminLoggedIn = false;
        let isSpecificDataLoggedIn = false;
        let currentAdminPage = 'dashboard';
        let currentGradeFilter = 'all';
        
        // Data Stores
        let lateData = [], lendingData = [], documentData = [], campData = [], specificData = [], forgotScanData = [], dashboardData = {};

        // Loading Flags (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Error 429)
        let isLendingLoading = false, isCampLoading = false, isDocLoading = false, isLateLoading = false, isForgotLoading = false, isSpecificLoading = false;

        // --- Signature Pad ---
        let signaturePad, signatureCtx, isDrawing = false, lastX = 0, lastY = 0;

        function initSignaturePad() {
            signaturePad = document.getElementById('lateSignatureCanvas');
            if (!signaturePad) return;
            signatureCtx = signaturePad.getContext('2d');
            signaturePad.width = signaturePad.offsetWidth; 
            signaturePad.height = signaturePad.offsetHeight;
            signatureCtx.strokeStyle = '#000'; signatureCtx.lineWidth = 2; signatureCtx.lineCap = 'round';
            
            ['mousedown', 'touchstart'].forEach(evt => signaturePad.addEventListener(evt, (e) => {
                isDrawing = true;
                const rect = signaturePad.getBoundingClientRect();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                lastX = clientX - rect.left; lastY = clientY - rect.top;
            }));
            ['mousemove', 'touchmove'].forEach(evt => signaturePad.addEventListener(evt, (e) => {
                if (!isDrawing) return;
                e.preventDefault();
                const rect = signaturePad.getBoundingClientRect();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                const x = clientX - rect.left, y = clientY - rect.top;
                signatureCtx.beginPath(); signatureCtx.moveTo(lastX, lastY); signatureCtx.lineTo(x, y); signatureCtx.stroke();
                lastX = x; lastY = y;
            }));
            ['mouseup', 'mouseout', 'touchend'].forEach(evt => signaturePad.addEventListener(evt, () => isDrawing = false));
        }
        function clearSignature() { if(signatureCtx) signatureCtx.clearRect(0, 0, signaturePad.width, signaturePad.height); }
        function isCanvasEmpty() { const blank = document.createElement('canvas'); blank.width = signaturePad.width; blank.height = signaturePad.height; return signaturePad.toDataURL() === blank.toDataURL(); }

        // --- Utility ---
        function showNotification(msg, type='success') {
            const n = document.createElement('div');
            n.className = `alert alert-${type} notification`; n.innerHTML = msg;
            document.body.appendChild(n);
            setTimeout(() => { n.classList.add('fade-out'); setTimeout(() => n.remove(), 300); }, 3000);
        }
        async function postToGoogleScript(data) {
            const params = new URLSearchParams(); params.append('data', JSON.stringify(data));
            const res = await fetch(SCRIPT_URL, { method: 'POST', headers: {'Content-Type': 'application/x-www-form-urlencoded'}, body: params });
            return res.json();
        }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        
        // --- Navigation & Loaders ---
        function showPage(pageId, fromHome = false) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            const btn = document.querySelector(`.nav-btn[onclick*="'${pageId}'"]`);
            if(btn) btn.classList.add('active');
            
            currentPage = pageId;
            if(pageId === 'late') { if(!lateData.length) loadLateData(); setTimeout(initSignaturePad, 100); }
            else if(pageId === 'forgot_scan') { if(!forgotScanData.length) loadForgotScanData(); document.getElementById('forgotDate').value = new Date().toISOString().split('T')[0]; }
            else if(pageId === 'lending') { if(!lendingData.length) loadLendingData(); }
            else if(pageId === 'documents') { if(!documentData.length) loadDocumentData(); }
            else if(pageId === 'camp') { if(!campData.length) loadCampData(false); }
            else if(pageId === 'specific_data') {
                if(isSpecificDataLoggedIn && !specificData.length) loadSpecificData();
                else if(!isSpecificDataLoggedIn) { document.getElementById('specificDataLogin').style.display='block'; document.getElementById('specificDataView').style.display='none'; }
            }
            else if(pageId === 'admin') {
                if(!isAdminLoggedIn) { document.getElementById('loginSection').style.display='block'; document.getElementById('adminPanel').style.display='none'; }
                else loadDataForAdminPage(currentAdminPage);
            }
        }
        
        // üéØ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô showAdminPage (‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà Global Scope)
        function showAdminPage(pageId) {
            currentAdminPage = pageId;
            document.querySelectorAll('.admin-page').forEach(p => p.classList.remove('active'));
            document.getElementById(`admin-page-${pageId}`).classList.add('active');
            
            document.querySelectorAll('.admin-nav-btn').forEach(b => b.classList.remove('active'));
            const navBtn = document.getElementById(`nav-${pageId}`);
            if (navBtn) navBtn.classList.add('active');

            loadDataForAdminPage(currentAdminPage);
        }

        // üéØ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô loadDataForAdminPage (‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà Global Scope)
        function loadDataForAdminPage(pageId) {
            currentAdminPage = pageId;
            document.querySelectorAll('.admin-page').forEach(p => p.classList.remove('active'));
            document.getElementById(`admin-page-${pageId}`).classList.add('active');
            
            document.querySelectorAll('.admin-nav-btn').forEach(b => b.classList.remove('active'));
            const navBtn = document.getElementById(`nav-${pageId}`);
            if (navBtn) navBtn.classList.add('active');

            switch (pageId) {
                case 'dashboard':
                    if (!dashboardData.stats) loadDashboardData(); 
                    else displayDashboard(dashboardData);
                    break;
                case 'camp':
                    if (campData.length === 0) loadCampData(true); 
                    else displayAdminCampData(campData);
                    break;
                case 'specific_data':
                    if (specificData.length === 0) loadSpecificData(true);
                    else displayAdminSpecificData(specificData);
                    break;
                case 'late':
                    if (lateData.length === 0) loadLateData(true);
                    else displayAdminLateData(lateData);
                    break;
                case 'forgot_scan':
                    if (forgotScanData.length === 0) loadForgotScanData(true);
                    else displayAdminForgotScanData(forgotScanData);
                    break;
                case 'lending':
                    if (lendingData.length === 0) loadLendingData(true);
                    else displayAdminLendingData(lendingData);
                    break;
                case 'documents':
                    if (documentData.length === 0) loadDocumentData(true);
                    else displayAdminDocumentData(documentData);
                    break;
                case 'config':
                    // loadDocTypes();
                    break;
            }
        }
        // --- END OF CORE NAVIGATION FIX ---


        // --- LENDING (‡∏¢‡∏∑‡∏°‡∏Ç‡∏≠‡∏á) ---
        document.getElementById('lendingForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button'); btn.disabled = true;
            const formData = {
                action: 'addLendingItem', // Correct for your backend
                studentId: document.getElementById('lendingStudentId').value,
                fullName: document.getElementById('lendingFullName').value,
                classroom: document.getElementById('lendingClassroom').value,
                phone: document.getElementById('lendingPhone').value,
                item: document.getElementById('lendingItem').value,
                status: '‡∏¢‡∏∑‡∏°', timestamp: new Date().toLocaleString('th-TH')
            };
            try {
                const res = await postToGoogleScript(formData);
                if(res.success) { showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); document.getElementById('lendingForm').reset(); await loadLendingData(true); }
                else showNotification('Error: '+res.message, 'danger');
            } catch(err) { showNotification('Connection Error', 'danger'); }
            btn.disabled = false;
        });

        async function loadLendingData(force = false) {
            if((lendingData.length > 0 && !force) || isLendingLoading) {
                if(lendingData.length > 0) { displayLendingData(lendingData); if(isAdminLoggedIn) displayAdminLendingData(lendingData); }
                return;
            }
            isLendingLoading = true;
            const elId = isAdminLoggedIn && currentAdminPage==='lending' ? 'adminLendingData' : 'lendingData';
            document.getElementById(elId).innerHTML = '<div class="alert alert-info">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';
            try {
                const res = await fetch(`${SCRIPT_URL}?action=getLendingItems`).then(r=>r.json()); // Correct action
                if(res.success) {
                    lendingData = res.data || [];
                    displayLendingData(lendingData); if(isAdminLoggedIn) displayAdminLendingData(lendingData);
                } else document.getElementById(elId).innerHTML = '<div class="alert alert-danger">‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>';
            } catch(e) { document.getElementById(elId).innerHTML = '<div class="alert alert-danger">‚ö†Ô∏è ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà)</div>'; }
            finally { isLendingLoading = false; }
        }

        function displayLendingData(data) {
            if(currentPage !== 'lending') return;
            const active = data.filter(r => r.status === '‡∏¢‡∏∑‡∏°');
            let html = active.length ? '<div style="overflow-x:auto;"><table class="table"><thead><tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°</th><th>‡∏Ç‡∏≠‡∏á</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th></tr></thead><tbody>' : '<div class="alert alert-success">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á</div>';
            if(active.length) {
                [...active].reverse().forEach(r => html += `<tr><td>${r.timestamp}</td><td>${r.fullName}</td><td>${r.item}</td><td><span class="status-badge" style="background:#dc3545">${r.status}</span></td></tr>`);
                html += '</tbody></table></div>';
            }
            document.getElementById('lendingData').innerHTML = html;
        }

        function displayAdminLendingData(data) {
             if(!isAdminLoggedIn || currentAdminPage !== 'lending') return;
             let html = '<div style="overflow-x:auto;"><table class="table"><thead><tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°</th><th>‡∏Ç‡∏≠‡∏á</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead><tbody>';
             [...data].reverse().forEach(r => html += `<tr>
                <td>${r.timestamp}</td>
                <td>${r.fullName} (${r.classroom})</td>
                <td>${r.item}</td>
                <td><span class="status-badge" style="background-color: ${r.status === '‡∏¢‡∏∑‡∏°' ? '#dc3545' : '#6c757d'}; color: white;">${r.status}</span></td>
                <td>${r.status === '‡∏¢‡∏∑‡∏°' ? `<button onclick="updateLendingStatus('${r.rowIndex}', '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß')" class="btn btn-success" style="padding: 5px 10px; font-size: 12px;">‚úÖ ‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß</button>` : `<button onclick="deleteLendingItem('${r.rowIndex}')" class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;">üóëÔ∏è ‡∏•‡∏ö</button>`}</td>
                </tr>`);
             html += '</tbody></table></div>';
             document.getElementById('adminLendingData').innerHTML = html;
        }

        // --- CAMP (‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏¢) ---
        document.getElementById('campForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button'); btn.disabled = true;
            
            const rowIndex = document.getElementById('campRowIndex').value;
            const actionName = rowIndex ? 'updateCampStudent' : 'addCampStudent';
            
            const formData = {
                action: actionName,
                rowIndex: rowIndex,
                studentId: document.getElementById('campStudentId').value,
                fullName: document.getElementById('campFullName').value,
                classroom: document.getElementById('campClassroom').value,
                status: document.getElementById('campStatus').value,
                follow: document.getElementById('campFollow').value,
                note: document.getElementById('campNote').value, // üéØ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
                createdAt: new Date().toLocaleString('th-TH')
            };
            
            try {
                const res = await postToGoogleScript(formData);
                if(res.success) {
                    showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                    closeModal('campModal');
                    await loadCampData(true, true); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
                } else {
                    showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + res.message, 'danger');
                }
            } catch(err) {
                showNotification('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ', 'danger');
            }
            btn.disabled = false;
        });

        async function loadCampData(isAdminView = false, force = false) {
            if((campData.length > 0 && !force) || isCampLoading) {
                if(campData.length > 0) {
                    if(isAdminView) displayAdminCampData(campData);
                    else { generateCampStats(campData); filterCampData(); }
                }
                return;
            }
            isCampLoading = true;
            const elId = isAdminView ? 'adminCampData' : 'campData';
            document.getElementById(elId).innerHTML = '<div class="alert alert-info">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';
            try {
                const res = await fetch(`${SCRIPT_URL}?action=getCampData`).then(r=>r.json()); // Correct action
                if(res.success) {
                    campData = res.data || [];
                    if(isAdminView) displayAdminCampData(campData);
                    else { generateCampStats(campData); filterCampData(); }
                } else document.getElementById(elId).innerHTML = '<div class="alert alert-danger">‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>';
            } catch(e) { document.getElementById(elId).innerHTML = '<div class="alert alert-danger">‚ö†Ô∏è ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà)</div>'; }
            finally { isCampLoading = false; }
        }

        function filterByGrade(grade, event) {
            currentGradeFilter = grade;
            document.querySelectorAll('.grade-filter-btn').forEach(btn => btn.classList.remove('active'));
            if(event && event.target) event.target.classList.add('active');
            filterCampData();
        }

        function filterCampData() {
            const sFilter = document.getElementById('campStatusFilter').value;
            const fFilter = document.getElementById('campFollowFilter').value;
            
            let filtered = campData.filter(item => {
                let matchGrade = (currentGradeFilter === 'all') || (item.classroom && item.classroom.startsWith(`‡∏°.${currentGradeFilter}`));
                let matchStatus = (sFilter === '') || (item.status === sFilter);
                let matchFollow = (fFilter === '') || (item.follow === fFilter);
                return matchGrade && matchStatus && matchFollow;
            });
            displayCampData(filtered);
        }

        function generateCampStats(data) {
            const total = data.length;
            const camp = data.filter(i => i.status === '‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏¢').length;
            const vol = data.filter(i => i.status === '‡∏à‡∏¥‡∏ï‡∏≠‡∏≤‡∏™‡∏≤').length;
            document.getElementById('campStats').innerHTML = `<div class="stats-card"><h3>${total}</h3><small>‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</small></div><div class="stats-card"><h3>${camp}</h3><small>‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏¢</small></div><div class="stats-card"><h3>${vol}</h3><small>‡∏à‡∏¥‡∏ï‡∏≠‡∏≤‡∏™‡∏≤</small></div>`;
        }

        // üéØ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
        function displayCampData(data) {
            let html = data.length ? '<div style="overflow-x:auto;"><table class="table"><thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏´‡πâ‡∏≠‡∏á</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</th><th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th></tr></thead><tbody>' : '<div class="alert alert-warning">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
            if(data.length) {
                data.forEach(r => html += `<tr><td>${r.fullName}</td><td>${r.classroom}</td><td><span class="status-badge status-${r.status}">${r.status}</span></td><td>${r.follow}</td><td>${r.note || '-'}</td></tr>`);
                html += '</tbody></table></div>';
            }
            document.getElementById('campData').innerHTML = html;
        }

        // üéØ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ ‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Admin
        function displayAdminCampData(data) {
             if(!isAdminLoggedIn) return;
             let html = '<div style="overflow-x:auto;"><table class="table"><thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏´‡πâ‡∏≠‡∏á</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead><tbody>';
             data.forEach((r, idx) => {
                 html += `<tr>
                    <td>${r.fullName}</td>
                    <td>${r.classroom}</td>
                    <td>${r.status}</td>
                    <td>${r.note || '-'}</td>
                    <td>
                        <div class="action-buttons">
                            <button onclick="editCampStudent(${idx})" class="btn btn-warning" style="padding: 5px 10px; font-size: 12px;">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            <button onclick="deleteCampData('${r.rowIndex}')" class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;">üóëÔ∏è ‡∏•‡∏ö</button>
                        </div>
                    </td>
                 </tr>`;
             });
             html += '</tbody></table></div>';
             document.getElementById('adminCampData').innerHTML = html;
        }

        // üéØ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Edit Camp Student (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Modal ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤)
        function editCampStudent(index) {
            const data = campData[index];
            const modal = document.getElementById('campModal');
            document.getElementById('campModalTitle').textContent = '‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô';
            
            document.getElementById('campRowIndex').value = data.rowIndex; // ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç! ‡πÄ‡∏Å‡πá‡∏ö rowIndex ‡πÑ‡∏ß‡πâ
            document.getElementById('campStudentId').value = data.studentId;
            document.getElementById('campFullName').value = data.fullName;
            document.getElementById('campClassroom').value = data.classroom;
            document.getElementById('campStatus').value = data.status;
            document.getElementById('campFollow').value = data.follow;
            document.getElementById('campNote').value = data.note || '';

            modal.style.display = 'flex';
        }
        
        // --- OTHER MODULES (Late, Forgot, Docs, Specific, Admin) ---
        // Late
        document.getElementById('lateForm').addEventListener('submit', async (e) => {
             e.preventDefault();
             if(isCanvasEmpty()) { showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠','warning'); return; }
             const btn = e.target.querySelector('button'); btn.disabled = true;
             try {
                 await postToGoogleScript({
                     action: 'addLateStudent', studentId: document.getElementById('lateStudentId').value,
                     fullName: document.getElementById('lateFullName').value, classroom: document.getElementById('lateClassroom').value,
                     signature: signaturePad.toDataURL(), timestamp: new Date().toLocaleString('th-TH')
                 });
                 showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); document.getElementById('lateForm').reset(); clearSignature(); await loadLateData(true);
             } catch(e) { showNotification('Error', 'danger'); }
             btn.disabled = false;
        });
        async function loadLateData(force=false) {
             if((lateData.length > 0 && !force) || isLateLoading) {
                 if(lateData.length > 0) { displayLateData(lateData); if(isAdminLoggedIn) displayAdminLateData(lateData); }
                 return;
             }
             isLateLoading = true;
             try {
                 const res = await fetch(`${SCRIPT_URL}?action=getLateStudents`).then(r=>r.json());
                 if(res.success) { lateData = res.data; displayLateData(lateData); if(isAdminLoggedIn) displayAdminLateData(lateData); }
             } catch(e){} finally { isLateLoading = false; }
        }
        function displayLateData(data) {
             const today = new Date().toLocaleDateString('th-TH');
             const todayData = data.filter(r => new Date(r.timestamp).toLocaleDateString('th-TH') === today);
             let html = todayData.length ? '<table class="table"><thead><tr><th>‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</th></tr></thead><tbody>' : '<div class="alert alert-warning">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏≤‡∏¢</div>';
             if(todayData.length) { [...todayData].reverse().forEach(r => html += `<tr><td>${new Date(r.timestamp).toLocaleTimeString('th-TH')}</td><td>${r.fullName}</td><td><img src="${r.signature}" height="30"></td></tr>`); html += '</tbody></table>'; }
             if(currentPage==='late') document.getElementById('lateData').innerHTML = html;
        }

        function displayAdminLateData(data) {
            if (!isAdminLoggedIn || currentAdminPage !== 'late') return;
            const container = document.getElementById('adminLateData');
            if (data.length === 0) { container.innerHTML = '<div class="alert alert-warning">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏™‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>'; return; }
            let html = '<div style="overflow-x: auto;"><table class="table"><thead><tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th><th>‡∏•‡∏ö</th></tr></thead><tbody>';
            [...data].reverse().forEach(record => { 
                html += `<tr>
                            <td>${new Date(record.timestamp).toLocaleString('th-TH')}</td>
                            <td>${record.studentId}</td>
                            <td>${record.fullName}</td>
                            <td>${record.classroom}</td>
                            <td><button onclick="deleteLateStudent('${record.rowIndex}')" class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;">üóëÔ∏è ‡∏•‡∏ö</button></td>
                        </tr>`;
            });
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // Forgot Scan
        document.getElementById('forgotScanForm').addEventListener('submit', async (e) => {
             e.preventDefault();
             const btn = e.target.querySelector('button'); btn.disabled = true;
             try {
                 await postToGoogleScript({
                     action: 'addForgotScan', studentId: document.getElementById('forgotStudentId').value,
                     fullName: document.getElementById('forgotFullName').value, classroom: document.getElementById('forgotClassroom').value,
                     forgotDate: document.getElementById('forgotDate').value, status: '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£', timestamp: new Date().toISOString()
                 });
                 showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); document.getElementById('forgotScanForm').reset(); await loadForgotScanData(true);
             } catch(e) { showNotification('Error', 'danger'); }
             btn.disabled = false;
        });
        async function loadForgotScanData(force=false) {
             if((forgotScanData.length > 0 && !force) || isForgotLoading) {
                if(forgotScanData.length > 0) { displayForgotScanData(forgotScanData); if(isAdminLoggedIn) displayAdminForgotScanData(forgotScanData); }
                return;
             }
             isForgotLoading = true;
             try {
                 const res = await fetch(`${SCRIPT_URL}?action=getForgotScanData`).then(r=>r.json());
                 if(res.success) { forgotScanData = res.data; displayForgotScanData(forgotScanData); if(isAdminLoggedIn) displayAdminForgotScanData(forgotScanData); }
             } catch(e){} finally { isForgotLoading = false; }
        }
        function displayForgotScanData(data) {
             let html = data.length ? '<table class="table"><thead><tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏∑‡∏°</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th></tr></thead><tbody>' : '<div class="alert alert-warning">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
             if(data.length) { [...data].reverse().forEach(r => html += `<tr><td>${r.forgotDate}</td><td>${r.fullName}</td><td>${r.status}</td></tr>`); html += '</tbody></table>'; }
             if(currentPage==='forgot_scan') document.getElementById('forgotScanData').innerHTML = html;
        }

        function displayAdminForgotScanData(data) {
            if (!isAdminLoggedIn || currentAdminPage !== 'forgot_scan') return;
            const container = document.getElementById('adminForgotScanData');
            if (data.length === 0) { container.innerHTML = '<div class="alert alert-warning">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏à‡πâ‡∏á‡∏•‡∏∑‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>'; return; }
            let html = '<div style="overflow-x: auto;"><table class="table"><thead><tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏∑‡∏°</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th></tr></thead><tbody>';
            data.forEach(record => {
                const originalIndex = record.rowIndex; // ‡πÉ‡∏ä‡πâ rowIndex ‡∏à‡∏≤‡∏Å GAS
                html += `<tr>
                            <td>${new Date(record.timestamp).toLocaleString('th-TH')}</td>
                            <td>${record.forgotDate}</td>
                            <td>${record.fullName} (${record.classroom})</td>
                            <td><span class="status-badge status-scan-${record.status}">${record.status}</span></td>
                            <td>`;
                if (record.status === '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£') {
                    html += `<div class="action-buttons">
                            <button onclick="updateForgotScanStatus('${originalIndex}', '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥')" class="btn btn-success" style="padding: 5px 10px; font-size: 12px;">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                            <button onclick="updateForgotScanStatus('${originalIndex}', '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥')" class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                            </div>`;
                } else {
                    html += '‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß';
                }
                html += `</td></tr>`;
            });
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // Documents
        async function loadDocumentData(force=false) {
             if((documentData.length > 0 && !force) || isDocLoading) {
                 if(documentData.length > 0) { displayDocumentData(documentData); if(isAdminLoggedIn) displayAdminDocumentData(documentData); }
                 return;
             }
             isDocLoading = true;
             try {
                 const res = await fetch(`${SCRIPT_URL}?action=getDocumentData`).then(r=>r.json());
                 if(res.success) { documentData = res.data; displayDocumentData(documentData); if(isAdminLoggedIn) displayAdminDocumentData(documentData); }
             } catch(e){} finally { isDocLoading = false; }
        }
        function displayDocumentData(data) {
             if(currentPage !== 'documents') return;
             let html = data.length ? '<table class="table"><thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th></tr></thead><tbody>' : '<div class="alert alert-warning">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
             if(data.length) { [...data].reverse().forEach(r => html += `<tr><td>${r.fullName}</td><td>${r.docType}</td><td>${r.status}</td></tr>`); html += '</tbody></table>'; }
             document.getElementById('documentData').innerHTML = html;
        }
        function filterDocumentData() {
             const q = document.getElementById('docSearch').value.toLowerCase();
             const filtered = documentData.filter(d => d.fullName.toLowerCase().includes(q) || d.studentId.includes(q));
             displayDocumentData(filtered);
        }

        function displayAdminDocumentData(data) {
            if (!isAdminLoggedIn || currentAdminPage !== 'documents') return;
            const container = document.getElementById('adminDocumentData');
            if (data.length === 0) { container.innerHTML = '<div class="alert alert-warning">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>'; return; }
            let html = '<div style="overflow-x: auto;"><table class="table"><thead><tr><th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏ß‡∏°</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead><tbody>';
            [...data].reverse().forEach((record, index) => {
                html += `<tr>
                            <td>${record.studentId}</td>
                            <td>${record.fullName}</td>
                            <td>${record.docType}</td>
                            <td><span class="doc-status-badge doc-status-${record.status}">${record.status}</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button onclick="editDocument(${index})" class="btn btn-warning" style="padding: 5px 10px; font-size: 12px;">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                    <button onclick="deleteDocument('${record.rowIndex}')" class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;">üóëÔ∏è ‡∏•‡∏ö</button>
                                </div>
                            </td>
                        </tr>`;
            });
            container.innerHTML = html + '</tbody></table></div>';
        }


        // Specific Data
        async function specificDataLogin() {
             if(document.getElementById('specificDataPassword').value === 'tp12345') {
                 isSpecificDataLoggedIn = true;
                 document.getElementById('specificDataLogin').style.display='none';
                 document.getElementById('specificDataView').style.display='block';
                 loadSpecificData();
             } else alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î');
        }
        async function loadSpecificData(force=false) {
             if((specificData.length > 0 && !force) || isSpecificLoading) {
                if(specificData.length > 0) { displaySpecificData(specificData); if(isAdminLoggedIn) displayAdminSpecificData(specificData); }
                return;
             }
             isSpecificLoading = true;
             try {
                 const res = await fetch(`${SCRIPT_URL}?action=getSpecificData`).then(r=>r.json());
                 if(res.success) { specificData = res.data; displaySpecificData(specificData); if(isAdminLoggedIn) displayAdminSpecificData(specificData); }
             } catch(e){} finally { isSpecificLoading = false; }
        }
        function displaySpecificData(data) {
             if(currentPage !== 'specific_data') return;
             let html = data.length ? '<table class="table"><thead><tr><th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th></tr></thead><tbody>' : '<div class="alert alert-warning">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
             if(data.length) {
                 data.forEach(r => {
                     let last = (r.offenses && r.offenses.length) ? r.offenses[r.offenses.length-1].detail : '-';
                     html += `<tr><td>${r.studentId}</td><td>${r.fullName}</td><td>${last}</td></tr>`;
                 });
                 html += '</tbody></table>';
             }
             document.getElementById('specificDataTableContainer').innerHTML = html;
        }

        function displayAdminSpecificData(data) {
             if(!isAdminLoggedIn || currentAdminPage !== 'specific_data') return;
             let html = '<div style="overflow-x: auto;"><table class="table"><thead><tr><th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead><tbody>';
             data.forEach((r, idx) => html += `<tr>
                <td>${r.studentId}</td>
                <td>${r.fullName}</td>
                <td>${r.offenses ? r.offenses.length : 0} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</td>
                <td>
                    <div class="action-buttons">
                        <button onclick="editSpecificData(${idx})" class="btn btn-warning" style="padding: 5px 10px; font-size: 12px;">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button onclick="deleteSpecificData('${r.rowIndex}')" class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;">üóëÔ∏è ‡∏•‡∏ö</button>
                    </div>
                </td>
             </tr>`);
             html += '</tbody></table></div>';
             document.getElementById('adminSpecificData').innerHTML = html;
        }

        function editSpecificData(index) {
            const data = specificData[index];
            const modal = document.getElementById('specificDataModal');
            const container = document.getElementById('specificOffensesContainer');
            
            document.getElementById('specificDataModalTitle').textContent = '‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞';
            
            document.getElementById('specificDataRowIndex').value = data.rowIndex;
            document.getElementById('specificDataStudentId').value = data.studentId;
            document.getElementById('specificDataFullName').value = data.fullName;
            document.getElementById('specificDataAddress').value = data.address || '';
            document.getElementById('specificDataParentName').value = data.parentName || '';
            document.getElementById('specificDataParentPhone').value = data.parentPhone || '';

            container.innerHTML = ''; 
            if(data.offenses && data.offenses.length > 0) {
                data.offenses.forEach(off => addSpecificOffenseField(off));
            } else {
                addSpecificOffenseField();
            }

            modal.style.display = 'flex';
        }
        
        function addSpecificOffenseField(data = null) {
             const c = document.getElementById('specificOffensesContainer');
             const i = c.children.length + 1;
             const div = document.createElement('div');
             div.className = 'offense-group';
             
             const detailVal = data ? data.detail : '';
             const locVal = data ? data.location : '';
             const actionVal = data ? data.action : '';
             
             div.innerHTML = `
                <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà ${i}</label>
                <input type="text" id="offenseDetail${i}" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î" value="${detailVal}">
                <input type="text" id="offenseLocation${i}" placeholder="‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà" value="${locVal}" style="margin-top:5px;">
                <input type="text" id="offenseAction${i}" placeholder="‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£" value="${actionVal}" style="margin-top:5px;">
             `;
             c.appendChild(div);
        }
        document.getElementById('specificDataForm').addEventListener('submit', async (e) => {
             e.preventDefault();
             const offenses = [];
             document.querySelectorAll('.offense-group').forEach((g, idx) => {
                 const i = idx+1;
                 const d = document.getElementById(`offenseDetail${i}`).value;
                 if(d) offenses.push({ detail: d, location: document.getElementById(`offenseLocation${i}`).value, action: document.getElementById(`offenseAction${i}`).value });
             });
             const data = {
                 action: 'addOrUpdateSpecificData', // Correct
                 rowIndex: document.getElementById('specificDataRowIndex').value, // üéØ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏™‡πà‡∏á rowIndex
                 studentId: document.getElementById('specificDataStudentId').value,
                 fullName: document.getElementById('specificDataFullName').value,
                 address: document.getElementById('specificDataAddress').value,
                 parentName: document.getElementById('specificDataParentName').value,
                 parentPhone: document.getElementById('specificDataParentPhone').value,
                 offenses: offenses
             };
             await postToGoogleScript(data);
             showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); closeModal('specificDataModal'); await loadSpecificData(true);
        });

        // Admin & Dashboard
        async function adminLogin() {
             if(document.getElementById('adminPassword').value === 'admin1234') {
                 isAdminLoggedIn = true;
                 document.getElementById('loginSection').style.display='none';
                 document.getElementById('adminPanel').style.display='block';
                 showAdminPage('dashboard');
             } else alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î');
        }
        function adminLogout() { location.reload(); }
        
        async function loadDashboardData() {
             const s = document.getElementById('dashStartDate').value || new Date().toISOString().split('T')[0];
             const e = document.getElementById('dashEndDate').value || new Date().toISOString().split('T')[0];
             try {
                 const res = await fetch(`${SCRIPT_URL}?action=getDashboardData&startDate=${s}&endDate=${e}`).then(r=>r.json());
                 if(res.success) {
                     dashboardData = res.data;
                     document.getElementById('dashboardStats').innerHTML = `<div class="stats-card"><h3>${dashboardData.stats.lateCount}</h3><small>‡∏°‡∏≤‡∏™‡∏≤‡∏¢</small></div><div class="stats-card"><h3>${dashboardData.stats.lendingCount}</h3><small>‡∏¢‡∏∑‡∏°‡∏Ñ‡πâ‡∏≤‡∏á</small></div>`;
                 }
             } catch(ex){}
        }

        function displayDashboard(data) {
             if(!isAdminLoggedIn) return;
             const stats = data.stats;
             document.getElementById('dashboardStats').innerHTML = `<div class="stats-card"><h3>${stats.lateCount}</h3><small>‡∏°‡∏≤‡∏™‡∏≤‡∏¢</small></div><div class="stats-card"><h3>${stats.lendingCount}</h3><small>‡∏¢‡∏∑‡∏°‡∏Ñ‡πâ‡∏≤‡∏á</small></div>`;
        }

        // Profile Search
        async function searchStudentProfile() {
             const id = document.getElementById('profileSearchId').value;
             if(!id) return;
             document.getElementById('profileResultContainer').innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...';
             try {
                 const res = await fetch(`${SCRIPT_URL}?action=getStudentProfile&studentId=${id}`).then(r=>r.json());
                 if(res.success && res.data.info) {
                     const d = res.data;
                     let h = `<div class="profile-card"><h3>${d.info.fullName} (${d.info.classroom})</h3>`;
                     if(d.late.length) h += `<p>‡∏°‡∏≤‡∏™‡∏≤‡∏¢ ${d.late.length} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>`;
                     if(d.lending.length) h += `<p>‡∏¢‡∏∑‡∏°‡∏Ç‡∏≠‡∏á ${d.lending.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>`;
                     h += '</div>';
                     document.getElementById('profileResultContainer').innerHTML = h;
                 } else document.getElementById('profileResultContainer').innerHTML = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
             } catch(e) { document.getElementById('profileResultContainer').innerHTML = 'Error'; }
        }
        
        // Export/Test Data Helpers
        function openCampModal() { document.getElementById('campModal').style.display='flex'; }
        function openSpecificDataModal() { document.getElementById('specificDataModal').style.display='flex'; document.getElementById('specificOffensesContainer').innerHTML=''; addSpecificOffenseField(); }
        function openDocumentModal() { document.getElementById('documentModal').style.display='flex'; }
        async function testData(type) {
             if(confirm('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö?')) {
                 await postToGoogleScript({action:'addTestData', type:type});
                 showNotification('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ú‡∏•');
             }
        }
        
        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Admin ---
        
        async function deleteLateStudent(rowIndex) {
            if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?')) return;
            showNotification('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...', 'info');
            try {
                const res = await postToGoogleScript({ action: 'deleteLateStudent', rowIndex: rowIndex });
                if (res.success) { showNotification('‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); await loadLateData(true); } else { showNotification('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + res.message, 'danger'); }
            } catch(e) { showNotification('Error', 'danger'); }
        }

        async function updateLendingStatus(rowIndex, newStatus) {
            if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞?')) return;
            showNotification('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï...', 'info');
            try {
                const res = await postToGoogleScript({ action: 'updateLendingStatus', rowIndex: rowIndex, status: newStatus });
                if (res.success) { showNotification('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); await loadLendingData(true); } else { showNotification('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + res.message, 'danger'); }
            } catch(e) { showNotification('Error', 'danger'); }
        }

        async function deleteLendingItem(rowIndex) {
            if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?')) return;
            showNotification('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...', 'info');
            try {
                const res = await postToGoogleScript({ action: 'deleteLendingItem', rowIndex: rowIndex });
                if (res.success) { showNotification('‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); await loadLendingData(true); } else { showNotification('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + res.message, 'danger'); }
            } catch(e) { showNotification('Error', 'danger'); }
        }

        async function deleteCampData(rowIndex) {
            if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?')) return;
            showNotification('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...', 'info');
            try {
                const res = await postToGoogleScript({ action: 'deleteCampStudent', rowIndex: rowIndex });
                if (res.success) { showNotification('‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); await loadCampData(true); } else { showNotification('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + res.message, 'danger'); }
            } catch(e) { showNotification('Error', 'danger'); }
        }

        async function updateForgotScanStatus(rowIndex, newStatus) {
            if (!confirm(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ${newStatus} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) return;
            showNotification(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞...`, 'info');
            try {
                const result = await postToGoogleScript({ action: 'updateForgotScanStatus', rowIndex: rowIndex, newStatus: newStatus });
                if (result.success) { showNotification('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success'); await loadForgotScanData(true); } 
                else { showNotification(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${result.message}`, 'danger'); }
            } catch (error) { showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠', 'danger'); }
        }

        function editDocument(index) {
            // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
            showNotification('‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå', 'warning');
            // ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ: openDocumentModal(index);
        }

        async function deleteDocument(rowIndex) {
             if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£?')) return;
            showNotification('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...', 'info');
            try {
                const res = await postToGoogleScript({ action: 'deleteDocument', rowIndex: rowIndex });
                if (res.success) { showNotification('‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); await loadDocumentData(true); } else { showNotification('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + res.message, 'danger'); }
            } catch(e) { showNotification('Error', 'danger'); }
        }
        
        // Initial Load
        document.addEventListener('DOMContentLoaded', () => {
            initSignaturePad();
            showPage('home');
            // Modal Close Events
            document.querySelectorAll('.modal').forEach(m => m.addEventListener('click', e => { if(e.target===m) m.style.display='none'; }));
        });
    </script>
</body>
</html>
